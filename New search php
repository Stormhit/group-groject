<html>
<head>
<title>CS3380 Group Project</title>
</head>
<body>
<form method="POST" action="<?= $_SERVER['PHP_SELF'] ?>">
        Search for a :
        <input type="radio" name="search_by" value="twit_user" />Twit_user
        <input type="radio" name="search_by" value="users"  />Users
        <input type="radio" name="search_by" value="tweets"  />Tweets
        <input type="radio" name="search_by" value="geo"  />Geo <br /><br />

    That contains: <input type="text" name="query_string" value="" /> <br /><br />
    <input type="submit" name="submit" value="Submit" />
</form>

<?php
        //Connecting to database
        include("../../secure/database.php");
        $dbconn = pg_connect(HOST." ".DBNAME." ".USERNAME." ".PASSWORD)
        or die('Could not connect: ' . pg_last_error());

        //Search part
        if(isset($_POST['submit'])){
                $searchterm = htmlspecialchars($_POST['query_string'] . '%');

		
		  if($_POST['search_by']=='twit_user'){
                        $result = pg_prepare($dbconn, "twit_user_lookup", 'SELECT * FROM twitStat.twit_user
                        WHERE (twit_user.usr_id ILIKE $1) ORDER BY (usr_id)');
                        $result = pg_execute($dbconn, "twit_user_lookup", array($searchterm))  or die ("wrong typing: ". pg_last_error());
                        echo "<br><br>\n\tThere are " . pg_num_rows($result) . " rows returned.\n</br>\n</br>";
                        echo "<table border= '1'>\n";
                        echo "<tr>
                                        <th>usr_id</th>
                                        <th>name</th>
                                        <th>screen_name</th>
                                        <th>location</th>
                                        <th>description</th>
                                        <th>followers</th>
                                        <th>friends</th>
                                        <th>created_at</th>
                                        <th>status_count</th>
                                        <th>fav_count</th>
                                        <th>lang</th>
                                        <th>profile_img_url</th>
                                        <th>default_img</th>
                                </tr></form>";
                        while ($row = pg_fetch_array($result,null,PGSQL_ASSOC)) {
                                echo "\t<tr>\n";

                                echo "
                                        <td>" . $row['usr_id'] . "</td>
                                        <td>" . $row['name'] . "</td>
                                        <td>" . $row['screen_name'] . "</td>
                                        <td>" . $row['location'] . "</td>
                                        <td>" . $row['description'] . "</td>
                                        <td>" . $row['followers'] . "</td>
                                        <td>" . $row['friends'] . "</td>
                                        <td>" . $row['created_at'] . "</td>
                                        <td>" . $row['status_count'] . "</td>
                                        <td>" . $row['fav_count'] . "</td>
                                        <td>" . $row['lang'] . "</td>
                                        <td>" . $row['profile_img_url'] . "</td>
                                        <td>" . $row['default_img'] . "</td>
                                        \t</tr>\n";
                        }
                        echo "</table> ";
              }

		if($_POST['search_by']=='users'){
			$result = pg_prepare($dbconn, "users_lookup", 'SELECT * FROM twitStat.users
                        WHERE (users.username ILIKE $1) ORDER BY (username)');
                        $result = pg_execute($dbconn, "users_lookup", array($searchterm))  or die ("wrong typing: ". pg_last_error());
                        echo "<br><br>\n\tThere are " . pg_num_rows($result) . " rows returned.\n</br>\n</br>";
                        echo "<table border= '1'>\n";
                        echo "<tr>
					<th>username</th> 	
					<th>password_hash</th>
					<th>salt</th>
					<th>screen_name</th>
				</ty></form>";
			
			while ($row = pg_fetch_array($result,null,PGSQL_ASSOC)) {
				echo "\t<tr>\n";

				echo "
					<td>" . $row['username'] . "</td>
					<td>" . $row['password'] ."</td>
					<td>" . $row['salt'] . "</td>
					<td>" . $row['screen_name'] . "</td>
					\t</tr>\n";
				}
			echo "</table> ";
		}
		
		if($_POST['search_by']=='tweets'){
			$result = pg_prepare($dbconn, "tweets_lookup", 'SELECT * FROM twitStat.tweets
			WHERE (tweets.tweet ILIKE $1) ORDER BY (tweet)');
			$result = pg_execute($dbconn, "tweets_lookup", array($searchterm))  or die ("wrong typing: ". pg_last_error());
                        echo "<br><br>\n\tThere are " . pg_num_rows($result) . " rows returned.\n</br>\n</br>";
                        echo "<table border= '1'>\n";
                        echo "<tr>
                                        <th>id</th>
                                        <th>tweet</th>
                                        <th>source</th>
                                        <th>user_id</th>
                                </ty></form>";

                        while ($row = pg_fetch_array($result,null,PGSQL_ASSOC)) {
                                echo "\t<tr>\n";

                                echo "
                                        <td>" . $row['id'] . "</td>
                                        <td>" . $row['tweet'] ."</td>
                                        <td>" . $row['source'] . "</td>
                                        <td>" . $row['user_id'] . "</td>
                                        \t</tr>\n";
                                }
                        echo "</table> ";
	
		}
		
		if($_POST['search_by']=='geo'){
			$result = pg_prepare($dbconn, "geo_lookup", 'SELECT * FROM twitStat.geo
                        WHERE (geo.latitude ILIKE $1) ORDER BY (id)');
                        $result = pg_execute($dbconn, "geo_lookup", array($searchterm))  or die ("wrong typing: ". pg_last_error());
                        echo "<br><br>\n\tThere are " . pg_num_rows($result) . " rows returned.\n</br>\n</br>";
                        echo "<table border= '1'>\n";
                        echo "<tr>
                                        <th>id</th>
                                        <th>latitude</th>
                                        <th>longitude</th>
                                </ty></form>";

                        while ($row = pg_fetch_array($result,null,PGSQL_ASSOC)) {
                                echo "\t<tr>\n";

                                echo "
                                        <td>" . $row['id'] . "</td>
                                        <td>" . $row['latitude'] ."</td>
                                        <td>" . $row['longitude'] . "</td>
                                        \t</tr>\n";
                                }
                        echo "</table> ";



		}
}
